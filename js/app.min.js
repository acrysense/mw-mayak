"use strict";

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }
function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _iterableToArray(iter) { if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter); }
function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }
function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }
function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); }
function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }
function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }
function _iterableToArrayLimit(r, l) { var t = null == r ? null : "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t["return"] && (u = t["return"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }
function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }
document.addEventListener('DOMContentLoaded', function () {
  // global vars
  var isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;

  // lenis
  var lenis = new Lenis({
    lerp: 0.07,
    smooth: true
  });
  function raf(time) {
    lenis.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);

  // function's
  function bodyFixScroll(status) {
    var scrollPosition = 0;
    var paddingOffset = window.innerWidth - document.body.offsetWidth + 'px';
    var elementsFixed = document.querySelectorAll('.fixed');
    if (status) {
      document.body.classList.add('scroll-disabled');
      scrollPosition = window.pageYOffset;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      if (document.body.style.top) {
        document.body.style.top = document.body.style.top;
      } else {
        document.body.style.top = '-' + scrollPosition + 'px';
      }
      document.body.style.width = '100%';
      document.body.style.paddingRight = paddingOffset;
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.marginRight = paddingOffset;
        });
      }
    } else {
      document.body.classList.remove('scroll-disabled');
      scrollPosition = Math.abs(parseInt(document.querySelector('body').style.top.replace('px', '')));
      document.body.style.removeProperty('overflow');
      document.body.style.removeProperty('position');
      document.body.style.removeProperty('top');
      document.body.style.removeProperty('width');
      document.body.style.removeProperty('padding-right');
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.removeProperty('margin-right');
        });
      }
      window.scrollTo({
        top: !isNaN(scrollPosition) ? scrollPosition : 0,
        behavior: 'instant'
      });
    }
  }

  // // main
  window.addEventListener('load', function () {
    if (document.querySelector('.main')) {
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
      bodyFixScroll(1);
      window.scrollTo(0, 0);
      document.body.classList.remove('is--loading');
      var tl = gsap.timeline({
        defaults: {
          duration: 0.9,
          ease: 'power1.out'
        }
      });
      tl.addLabel('startFirst');
      tl.fromTo('.main__decor--first', {
        x: '-100%'
      }, {
        x: '0%',
        delay: 0.5
      }, 'startFirst');
      tl.fromTo('.main__decor--second', {
        y: '100%'
      }, {
        y: '0%',
        delay: 0.5
      }, 'startFirst');
      tl.fromTo('.main__decor--third', {
        y: '-100%'
      }, {
        y: '0%',
        delay: 0.5,
        ease: 'power2.out'
      }, 'startFirst');
      tl.fromTo('.main__decor--fourty', {
        x: '100%'
      }, {
        x: '0%',
        delay: 0.5,
        ease: 'power2.out'
      }, 'startFirst');
      tl.fromTo('.main__preview', {
        clipPath: 'inset(0% 0% 100% 0%)'
      }, {
        clipPath: 'inset(0% 0% 0% 0%)',
        duration: 0.8,
        delay: 0.7
      }, 'startFirst');
      tl.fromTo('.main__logo', {
        x: '-10%',
        opacity: 0
      }, {
        x: '0%',
        opacity: 1,
        delay: 0.9,
        ease: 'power2.out'
      }, 'startFirst');
      tl.addLabel('startSecond');
      tl.to('.main__decor--second', {
        x: '10%',
        y: '100%',
        delay: 0.5
      }, 'startSecond');
      tl.to('.main__decor--third', {
        x: '100%',
        delay: 0.5,
        ease: 'power1.out'
      }, 'startSecond');
      tl.to('.main__preview', {
        opacity: '0',
        delay: 0.6
      }, 'startSecond');
      tl.to('.main__logo', {
        x: '4%',
        opacity: 0,
        delay: 0.5,
        duration: 0.8,
        ease: 'power1.out'
      }, 'startSecond');
      tl.fromTo('.main__bg', {
        clipPath: 'inset(100% 0% 0% 0%)'
      }, {
        clipPath: 'inset(0% 0% 0% 0%)',
        delay: 0.5
      }, 'startSecond');
      tl.fromTo('.main__decor--fifth', {
        y: '-100%'
      }, {
        y: '0%',
        delay: 0.5
      }, 'startSecond');
      tl.addLabel('startThird');
      tl.to('.main__decor--fourty', {
        x: '100%',
        delay: 0.5,
        duration: 0.8
      }, 'startThird');
      tl.to('.main__decor--fifth', {
        width: '100%',
        delay: 0.5,
        duration: 0.8
      }, 'startThird');
      tl.to('.main__bg', {
        y: '19.9305555556vw',
        delay: 0.5,
        duration: 0.8
      }, 'startThird');
      tl.fromTo('.main__img', {
        y: '-100%',
        opacity: 0
      }, {
        y: '0%',
        opacity: 1,
        delay: 0.5,
        duration: 0.8
      }, 'startThird');
      tl.fromTo('.header', {
        opacity: 0
      }, {
        opacity: 1,
        delay: 1.3,
        duration: 0.8
      }, 'startThird');
      setTimeout(function () {
        bodyFixScroll();
      }, 4400);
    }
    if (document.querySelector('.main-inner')) {
      var debounce = function debounce(fn, ms) {
        var timer;
        return function () {
          clearTimeout(timer);
          timer = setTimeout(fn, ms);
        };
      };
      var recalcBgY = function recalcBgY() {
        var w = window.innerWidth;
        var value = null;
        if (w >= 1024) {
          value = '19.9305555556vw';
        } else if (w >= 744 && w <= 1023) {
          value = '29.9305555556vw';
        } else {
          value = '39.9305555556vw';
        }
        gsap.set('.main-inner__bg img', {
          y: value
        });
      };
      if ('scrollRestoration' in history) {
        history.scrollRestoration = 'manual';
      }
      bodyFixScroll(1);
      window.scrollTo(0, 0);
      document.body.classList.remove('is--loading');
      var _tl = gsap.timeline({
        defaults: {
          duration: 0.9,
          ease: 'power1.out'
        }
      });
      _tl.addLabel('startFirst');
      _tl.fromTo('.main-inner__decor--top', {
        x: '100%'
      }, {
        x: '-100%',
        delay: 0.5
      }, 'startFirst');
      _tl.fromTo('.main-inner__decor--bottom', {
        x: '-100%'
      }, {
        x: '100%',
        delay: 0.5
      }, 'startFirst');
      _tl.addLabel('startSecond');
      _tl.to('.main-inner__bg img', {
        y: window.innerWidth >= 1024 ? '19.9305555556vw' : window.innerWidth >= 744 ? '29.9305555556vw' : '39.9305555556vw',
        delay: 0.3,
        duration: 0.7
      }, 'startSecond');
      _tl.fromTo('.main-inner__heading span:first-child', {
        x: '-10%',
        opacity: 0
      }, {
        x: '0%',
        opacity: 1,
        delay: 0.7,
        duration: 0.8
      }, 'startSecond');
      if (document.querySelector('.main-inner__heading span:nth-child(2)')) {
        _tl.fromTo('.main-inner__heading span:nth-child(2)', {
          x: '10%',
          opacity: 0
        }, {
          x: '0%',
          opacity: 1,
          delay: 0.7,
          duration: 0.8
        }, 'startSecond');
      }
      _tl.addLabel('startThird').add(bgTween, 'startSecond');
      _tl.fromTo('.header', {
        opacity: 0
      }, {
        opacity: 1,
        duration: 0.8
      }, 'startThird');
      _tl.fromTo('.main-inner__block', {
        opacity: 0
      }, {
        opacity: 1,
        duration: 0.8
      }, 'startThird');
      _tl.fromTo('.main-inner__bottom', {
        opacity: 0
      }, {
        opacity: 1,
        duration: 0.8
      }, 'startThird');
      var _tl$getTweensOf = _tl.getTweensOf('.main-inner__bg img'),
        _tl$getTweensOf2 = _slicedToArray(_tl$getTweensOf, 1),
        bgTween = _tl$getTweensOf2[0];
      window.addEventListener('resize', debounce(recalcBgY, 150));
      setTimeout(function () {
        bodyFixScroll();
      }, 3300);
    }
  });

  // image map resize
  if (typeof imageMapResize === 'function') {
    imageMapResize();
  } else {
    console.error('imageMapResize not loaded.');
  }

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) break;
        currentEl = currentEl.parentNode;
      }
      if (!currentEl) {
        onClickOutside();
        removeBodyChecker();
      }
    };
    function setBodyChecker() {
      document.documentElement.addEventListener('click', checkBodyClick);
    }
    function removeBodyChecker() {
      document.documentElement.removeEventListener('click', checkBodyClick);
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // aos
  AOS.init({
    once: true
  });

  // textarea
  var allTexareas = document.querySelectorAll('textarea');
  if (allTexareas) {
    allTexareas.forEach(function (el) {
      el.style.height = el.setAttribute('style', 'height: ' + el.scrollHeight + 'px');
      el.classList.add('auto');
      el.addEventListener('input', function (e) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      });
    });
  }

  // select
  (function () {
    var selectBoxes = document.querySelectorAll('.select-box');
    if (!selectBoxes.length) return;
    function closeBox(box) {
      box.classList.remove('is--active');
      document.removeEventListener('click', box._onBodyClick);
    }
    selectBoxes.forEach(function (selectBox) {
      var isSingle = selectBox.classList.contains('select-box--single');
      var selectedEl = selectBox.querySelector('.select-box__selected');
      var placeholder = selectedEl.querySelector('.select-box__placeholder');
      var valuesDisp = selectedEl.querySelector('.select-box__values');
      function onBodyClick(e) {
        if (!selectBox.contains(e.target)) {
          closeBox(selectBox);
        }
      }
      selectBox._onBodyClick = onBodyClick;
      function updateMulti() {
        var checked = Array.from(selectBox.querySelectorAll('input[type="checkbox"]:checked'));
        var count = checked.length;
        console.log('> updateMulti — selected count:', count);
        var titles = checked.map(function (input) {
          var _opt$querySelector, _opt$querySelector2;
          var opt = input.closest('.select-box__option');
          return (opt === null || opt === void 0 || (_opt$querySelector = opt.querySelector('.select-box__value')) === null || _opt$querySelector === void 0 ? void 0 : _opt$querySelector.textContent.trim()) || (opt === null || opt === void 0 || (_opt$querySelector2 = opt.querySelector('.select-box__title')) === null || _opt$querySelector2 === void 0 ? void 0 : _opt$querySelector2.textContent.trim()) || '';
        }).filter(function (t) {
          return t;
        });
        valuesDisp.textContent = titles.join(', ');
        selectBox.classList.toggle('is--selected', count > 0);
      }
      selectedEl.addEventListener('click', function (e) {
        e.stopPropagation();
        if (selectBox.classList.contains('is--active')) {
          closeBox(selectBox);
        } else {
          selectBoxes.forEach(function (sb) {
            return sb !== selectBox && closeBox(sb);
          });
          selectBox.classList.add('is--active');
          document.addEventListener('click', onBodyClick);
        }
      });
      selectBox.querySelectorAll('.select-box__option').forEach(function (option) {
        var _label$querySelector, _option$querySelector;
        var input = option.querySelector('input');
        var label = option.querySelector('.select-box__label');
        var title = ((_label$querySelector = label.querySelector('.select-box__title')) === null || _label$querySelector === void 0 ? void 0 : _label$querySelector.textContent.trim()) || ((_option$querySelector = option.querySelector('.select-box__value')) === null || _option$querySelector === void 0 ? void 0 : _option$querySelector.textContent.trim()) || label.textContent.trim();
        option.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          if (isSingle) {
            var was = input.checked;
            selectBox.querySelectorAll('input').forEach(function (i) {
              return i.checked = false;
            });
            if (!was) {
              input.checked = true;
              valuesDisp.textContent = title;
              valuesDisp.classList.add('is--active');
              placeholder.classList.remove('is--active');
              closeBox(selectBox);
            } else {
              valuesDisp.textContent = '';
              valuesDisp.classList.remove('is--active');
              placeholder.classList.add('is--active');
            }
          } else {
            input.checked = !input.checked;
            updateMulti();
          }
        });
      });
      if (!isSingle) {
        updateMulti();
      }
    });
  })();

  // lottie
  var bgWaves = document.getElementById('bg-waves');
  var mayakWaves = document.getElementById('mayak-waves');
  if (bgWaves) {
    var bgWavesAnimation = lottie.loadAnimation({
      container: bgWaves,
      renderer: 'svg',
      loop: true,
      autoplay: true,
      path: 'white-lines.json'
    });
  }
  if (mayakWaves) {
    var playAnimation = function playAnimation(entries, observer) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          mayakWavesAnimation.play(); // Запускаем анимацию, когда она в зоне видимости
          observer.unobserve(entry.target); // Отключаем наблюдение, если анимация должна проиграться только один раз
        }
      });
    }; // Настройка наблюдателя
    var mayakWavesAnimation = lottie.loadAnimation({
      container: mayakWaves,
      renderer: 'svg',
      loop: true,
      autoplay: false,
      path: 'mayak-waves.json'
    });
    var observer = new IntersectionObserver(playAnimation, {
      root: null,
      // null означает, что мы отслеживаем видимость элемента относительно окна браузера
      threshold: 0.5 // Порог видимости (0.5 означает, что 50% элемента должно быть видно, чтобы сработать)
    });

    // Начинаем наблюдать за контейнером анимации
    observer.observe(mayakWaves);
  }

  // select case
  var selectCaseBg = document.querySelectorAll('.select-case__map');
  if (selectCaseBg) {
    selectCaseBg.forEach(function (area) {
      var isLeft = area.classList.contains('select-case__map--left');
      var bg = document.querySelector(".select-case__bg-svg--".concat(isLeft ? 'left' : 'right'));
      var info = document.querySelector(".select-case__info--".concat(isLeft ? 'left' : 'right'));
      var circle = document.querySelector(".select-case__circle--".concat(isLeft ? 'left' : 'right'));
      area.addEventListener('mouseover', function () {
        if (!isTouchDevice) {
          bg.style.opacity = '1';
          info.style.opacity = '1';
          circle.style.opacity = '1';
        }
      });
      area.addEventListener('mouseout', function () {
        if (!isTouchDevice) {
          bg.style.opacity = '0';
          info.style.opacity = '0';
          circle.style.opacity = '0';
        }
      });
    });
  }

  // complex
  var complexBg = document.querySelectorAll('.complex__area');
  var complexInfo = document.querySelector('.complex-info');
  var activeArea = null;
  function showInfo(area) {
    var complex = area.dataset.complex;
    var value = area.dataset.value;
    var text = area.dataset.text;
    var url = area.href;
    var offset = (8 - value) * 40;
    document.querySelector(".complex__bg-svg[data-complex=\"".concat(complex, "\"][data-value=\"").concat(value, "\"]")).classList.add('is--active');
    complexInfo.classList.add('is--active', "complex-info--".concat(complex), "complex-info--stage-".concat(value));
    complexInfo.style.transform = "translateY(".concat(offset, "px)");
    complexInfo.querySelector('.complex-info__value').innerHTML = '0' + complex;
    complexInfo.querySelector('.complex-info__text').innerHTML = text;
    var link = complexInfo.querySelector('.complex-info__link');
    link.setAttribute('href', url);
  }
  function hideInfo() {
    document.querySelectorAll('.complex__bg-svg').forEach(function (el) {
      return el.classList.remove('is--active');
    });
    complexInfo.className = 'complex-info';
    complexInfo.style.transform = '';
    complexInfo.querySelector('.complex-info__value').innerHTML = '';
    complexInfo.querySelector('.complex-info__text').innerHTML = '';
  }
  if (complexBg && complexInfo) {
    complexBg.forEach(function (area) {
      var complex = area.dataset.complex;
      var value = area.dataset.value;
      var text = area.dataset.text;
      var complexInfoValue = complexInfo.querySelector('.complex-info__value');
      var complexInfoText = complexInfo.querySelector('.complex-info__text');
      area.addEventListener('mouseover', function () {
        // if (!isTouchDevice) {
        //     const selector = `.complex__bg-svg[data-complex="${complex}"][data-value="${value}"]`;
        //     const target = document.querySelector(selector);
        //     const offset = (8 - value) * 40;

        //     target.classList.add('is--active')
        //     complexInfo.classList.add('is--active')
        //     complexInfo.classList.add(`complex-info--${complex}`)
        //     complexInfo.classList.add(`complex-info--stage-${value}`)

        //     complexInfo.style.transform = `translateY(${offset}px)`;

        //     complexInfoValue.innerHTML = '0' + complex
        //     complexInfoText.innerHTML = text
        // }
        if (!isTouchDevice) showInfo(area);
      });
      area.addEventListener('mouseout', function () {
        // if (!isTouchDevice) {
        //     document.querySelectorAll('.complex__bg-svg').forEach(item => item.classList.remove('is--active'))

        //     complexInfo.classList.remove('is--active')
        //     complexInfo.classList.remove(`complex-info--${complex}`)
        //     complexInfo.classList.remove(`complex-info--stage-${value}`)
        //     complexInfo.style.transform = '';

        //     complexInfoValue.innerHTML = ''
        //     complexInfoText.innerHTML = ''
        // }
        if (!isTouchDevice) hideInfo();
      });
      area.addEventListener('click', function (e) {
        if (!isTouchDevice) return;
        e.preventDefault();
        e.stopPropagation();
        if (activeArea && activeArea !== area) {
          hideInfo();
          activeArea = null;
        }
        if (activeArea !== area) {
          showInfo(area);
          activeArea = area;
        } else {
          var url = area.dataset.url;
          if (url) window.location.href = url;
        }
      });
    });
    document.addEventListener('click', function (e) {
      if (activeArea && !activeArea.contains(e.target) && !complexInfo.contains(e.target)) {
        hideInfo();
        activeArea = null;
      }
    });
  }

  // nav map
  var navMapTabsItems = document.querySelectorAll('.nav-map-tabs__item');
  var navMapTabsTitle = document.querySelectorAll('.nav-map-tabs__tab');
  var navMapQuoteMore = document.querySelectorAll('.nav-map-quote__more');
  var navMapQuoteBody = document.querySelector('.nav-map-quote__body');
  var navMapAmenitiesTabs = document.querySelectorAll('.nav-map-amenities__tab');
  var navMapAmenitiesDotButtons = document.querySelectorAll('.nav-map__dots');
  var navMapBackground = document.querySelector('.nav-map-tabs__holder--gradient');
  var navMapDetailsAdress = document.querySelector('.nav-map-details__address');
  var navMapDetailsDistance = document.querySelector('.nav-map-details__distance span');
  var navMapDetailsHeading = document.querySelector('.nav-map-details__heading');
  var navMapDetailsValueIcon = document.querySelector('.nav-map-details__value use');
  var navMapDetailsValueName = document.querySelector('.nav-map-details__value span');
  if (navMapTabsItems) {
    navMapTabsItems.forEach(function (item, i) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.nav-map-tabs');
        parent.querySelectorAll('.nav-map-tabs__item').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        parent.querySelectorAll('.nav-map-tabs__holder').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        item.classList.add('is--active');
        var el = parent.querySelector('.is--active');
        var index = _toConsumableArray(parent.querySelectorAll('.nav-map-tabs__item')).indexOf(el);
        parent.querySelectorAll('.nav-map-tabs__holder')[index].classList.add('is--active');
      });
    });
  }
  if (navMapTabsTitle) {
    navMapTabsTitle.forEach(function (item) {
      var close = function close() {
        var parent = item.closest('.nav-map-tabs');
        var description = parent.querySelector('.nav-map-tabs__holder.is--active .nav-map__info');
        description.classList.remove('is--active');
      };
      var itemChecker = useItemChecker([item.parentNode], close);
      item.addEventListener('click', function (event) {
        if (window.innerWidth <= 1023) {
          event.preventDefault();
          var parent = item.closest('.nav-map-tabs');
          var description = parent.querySelector('.nav-map-tabs__holder.is--active .nav-map__info');
          if (description.classList.contains('is--active')) {
            close();
          } else {
            description.classList.add('is--active');
            itemChecker.setBodyChecker();
          }
        }
      });
    });
  }
  if (navMapQuoteMore) {
    navMapQuoteMore.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = item.closest('.nav-map-quote__body');
        if (parent.classList.contains('is--expanded')) {
          parent.classList.remove('is--expanded');
          setTimeout(function () {
            parent.classList.add('is--abbreviated');
          }, 200);
        } else {
          parent.classList.remove('is--abbreviated');
          parent.classList.add('is--expanded');
        }
      });
    });
  }
  if (navMapQuoteBody) {
    if (window.innerWidth <= 743) {
      navMapQuoteBody.classList.add('is--abbreviated');
    }
  }
  if (navMapAmenitiesTabs) {
    navMapAmenitiesTabs.forEach(function (tab) {
      tab.addEventListener('click', function (event) {
        event.preventDefault();
        var parent = tab.closest('.nav-map-amenities__item');
        if (parent.classList.contains('is--active')) {
          navMapAmenitiesTabs.forEach(function (btn) {
            return btn.closest('.nav-map-amenities__item').classList.remove('is--active');
          });
          navMapAmenitiesDotButtons.forEach(function (dot) {
            return dot.classList.remove('is--active');
          });
        } else {
          navMapAmenitiesTabs.forEach(function (btn) {
            return btn.closest('.nav-map-amenities__item').classList.remove('is--active');
          });
          navMapAmenitiesDotButtons.forEach(function (dot) {
            dot.classList.remove('is--active');
            if (dot.getAttribute('data-type') === tab.dataset.type) {
              dot.classList.add('is--active');
            }
          });
          parent.classList.add('is--active');
        }
      });
    });
  }
  if (navMapAmenitiesDotButtons) {
    navMapAmenitiesDotButtons.forEach(function (dotButton) {
      dotButton.addEventListener('click', function () {
        var address = dotButton.getAttribute('data-address');
        var heading = dotButton.getAttribute('data-heading');
        var name = dotButton.getAttribute('data-type-name');
        var icon = dotButton.getAttribute('data-icon');
        var distance = dotButton.getAttribute('data-distance');
        navMapDetailsAdress.innerHTML = address || '';
        navMapDetailsHeading.innerHTML = heading || '';
        navMapDetailsValueIcon.setAttribute('xlink:href', "img/sprite.svg#icon-".concat(icon) || '');
        navMapDetailsValueName.innerHTML = name || '';
        if (distance) {
          navMapDetailsDistance.innerHTML = distance;
          navMapDetailsDistance.closest('.nav-map-details__distance').classList.add('is--active');
        } else {
          navMapDetailsDistance.innerHTML = '';
          navMapDetailsDistance.closest('.nav-map-details__distance').classList.remove('is--active');
        }
        navMapAmenitiesTabs.forEach(function (btn) {
          return btn.closest('.nav-map-amenities__item').classList.remove('is--active');
        });
        navMapAmenitiesDotButtons.forEach(function (dot) {
          return dot.classList.remove('is--active');
        });
        dotButton.classList.add('is--active');
      });
    });
  }
  if (navMapBackground) {
    navMapBackground.addEventListener('click', function (event) {
      event.preventDefault();
      if (!event.target.classList.contains('nav-map__dots') && !event.target.closest('.nav-map__dots')) {
        navMapDetailsAdress.innerHTML = 'ул. Содружества, 47';
        navMapDetailsHeading.innerHTML = 'ЖК Маяк';
        navMapDetailsValueIcon.setAttribute('xlink:href', "img/sprite.svg#icon-mayak");
        navMapDetailsValueName.innerHTML = 'Жилой комплекс';
        navMapDetailsDistance.innerHTML = '';
        navMapDetailsDistance.closest('.nav-map-details__distance').classList.remove('is--active');
        if (!event.target.classList.contains('nav-map-amenities__tab') && !event.target.closest('.nav-map-amenities__tab')) {
          navMapAmenitiesTabs.forEach(function (btn) {
            return btn.closest('.nav-map-amenities__item').classList.remove('is--active');
          });
          navMapAmenitiesDotButtons.forEach(function (dot) {
            return dot.classList.remove('is--active');
          });
        }
      }
    });
  }

  // gsap
  var animateGSAP = document.querySelectorAll('.animate');
  var animateVSGSAP = document.querySelectorAll('.animate-vs');
  var parallaxGSAP = document.querySelectorAll('.parallax-section');
  if (animateGSAP) {
    gsap.registerPlugin(ScrollTrigger);
    gsap.utils.toArray('.animate').forEach(function (element) {
      gsap.to(element, {
        y: 0,
        opacity: 1,
        duration: 1.5,
        ease: "power3.out",
        scrollTrigger: {
          trigger: element,
          start: "top 85%",
          end: "top 65%",
          scrub: false,
          toggleActions: "play none none none"
        }
      });
    });
  }
  if (animateVSGSAP) {
    gsap.registerPlugin(ScrollTrigger);
    gsap.utils.toArray('.animate-vs').forEach(function (element) {
      gsap.to(element, {
        opacity: 1,
        duration: 1.5,
        ease: "power3.out",
        scrollTrigger: {
          trigger: element,
          start: "top 70%",
          end: "top 50%",
          scrub: false,
          toggleActions: "play none none none"
        }
      });
    });
  }
  if (parallaxGSAP) {
    gsap.registerPlugin(ScrollTrigger);
    gsap.utils.toArray('.parallax-section').forEach(function (section) {
      var image = section.querySelector('.parallax-image');
      gsap.to(image, {
        y: function y(index, target) {
          return -target.offsetHeight * 0.2;
        },
        ease: "none",
        scrollTrigger: {
          trigger: section,
          start: "top bottom",
          end: "bottom top",
          scrub: true
        }
      });
    });
  }

  // promo details animation
  var promoDetailsItem = document.querySelectorAll('.promo-details__item');
  var handleScroll = function handleScroll() {
    var viewportHeight = window.innerHeight || document.documentElement.clientHeight;
    var viewportCenter = viewportHeight / 2;
    promoDetailsItem.forEach(function (item) {
      var rect = item.getBoundingClientRect();
      var itemCenter = rect.top + rect.height / 2;
      if (itemCenter > viewportCenter - rect.height / 2 && itemCenter < viewportCenter + rect.height / 2) {
        // const targetHeight = viewportHeight * 0.8;
        // item.style.height = `${targetHeight}px`;

        if (!item.classList.contains('is--open')) {
          item.classList.add('is--open');
        }
      } else {
        if (item.classList.contains('is--open')) {
          item.classList.remove('is--open');
        }
      }
    });

    // ScrollTrigger.refresh();
  };

  handleScroll();
  window.addEventListener('scroll', handleScroll);
  window.addEventListener('resize', function () {
    handleScroll();
    if (navMapQuoteBody) {
      if (window.innerWidth <= 743) {
        navMapQuoteBody.classList.add('is--abbreviated');
      } else {
        navMapQuoteBody.classList.remove('is--abbreviated');
      }
    }
  });

  // menu
  var header = document.getElementById('header');
  var navbar = document.getElementById('navbar');
  var menu = document.getElementById('menu');
  var menuTrigger = document.querySelectorAll('.hamburger');
  if (header && menu && menuTrigger) {
    menuTrigger.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (menu.classList.contains('is--active')) {
          header.classList.remove('is--menu');
          item.classList.remove('is--active');
          menu.classList.remove('is--active');
          if (navbar) {
            navbar.classList.remove('is--menu');
          }
          bodyFixScroll();
        } else {
          header.classList.add('is--menu');
          item.classList.add('is--active');
          menu.classList.add('is--active');
          if (navbar) {
            if (navbar.classList.contains('is--active')) {
              navbar.classList.add('is--menu');
            }
          }
          bodyFixScroll(1);
        }
      });
    });
  }

  // menu nav
  var menuNavLink = document.querySelectorAll('.menu__link');
  var menuImg = document.querySelector('.menu__img');
  if (menuNavLink) {
    menuNavLink.forEach(function (link) {
      link.addEventListener('mouseenter', function (event) {
        var source = link.dataset.img;
        // const linkRect = link.getBoundingClientRect();

        menuImg.querySelector('img').src = source;
        if (!menuImg.classList.contains('is--active')) {
          menuImg.classList.add('is--active');
        }

        // menuImg.querySelector('img').onload = function () {
        //     const imgRect = menuImg.getBoundingClientRect();

        //     // let imgX = linkRect.right;
        //     // let imgY = linkRect.top;
        //     let imgX = event.clientX + 20;
        //     let imgY = event.clientY + 20;

        //     // if (imgX + imgRect.width > window.innerWidth) {
        //     //     imgX = linkRect.left - imgRect.width;
        //     // }

        //     // if (imgY + imgRect.height > window.innerHeight) {
        //     //     imgY = window.innerHeight - imgRect.height;
        //     // }

        //     if (imgX + imgRect.width > window.innerWidth) {
        //         imgX = window.innerWidth - imgRect.width - 10;
        //     }
        //     if (imgY + imgRect.height > window.innerHeight) {
        //         imgY = window.innerHeight - imgRect.height - 10;
        //     }

        //     menuImg.style.left = `${imgX}px`;
        //     menuImg.style.top = `${imgY}px`;

        //     if (!menuImg.classList.contains('is--active')) {
        //         menuImg.classList.add('is--active')
        //     }
        // };
      });

      link.addEventListener('mousemove', function (event) {
        var imgRect = menuImg.getBoundingClientRect();
        var imgX = event.clientX - 25;
        var imgY = event.clientY + 25;
        if (imgX + Number(60) + imgRect.width > window.innerWidth) {
          imgX = event.clientX - imgRect.width - 85;
        }
        if (imgY + imgRect.height > window.innerHeight) {
          imgY = window.innerHeight - imgRect.height;
        }
        menuImg.style.left = "".concat(imgX, "px");
        menuImg.style.top = "".concat(imgY, "px");
      });
      link.addEventListener('mouseleave', function () {
        if (menuImg.classList.contains('is--active')) {
          menuImg.classList.remove('is--active');
        }
      });
      link.addEventListener('click', function () {
        if (href && href.startsWith('#')) {
          if (document.querySelector('.menu')) {
            document.querySelector('.menu').classList.remove('is--active');
          }
        }
      });
    });
  }

  // btn to top
  var btnToTop = document.querySelector('.footer__to-top');
  var rootElement = document.documentElement;
  function scrollToTop() {
    rootElement.scrollTo({
      top: 0,
      behavior: 'smooth'
    });
  }
  if (btnToTop) {
    btnToTop.addEventListener('click', scrollToTop);
  }

  // gallery slider
  var gallerySlider = document.querySelector('.gallery__slider .swiper');
  if (gallerySlider) {
    var myGallerySlider = new Swiper(gallerySlider, {
      slidesPerView: 1,
      loop: true,
      allowTouchMove: false,
      speed: 800,
      parallax: true,
      watchSlidesProgress: true,
      navigation: {
        prevEl: '.gallery__slider .swiper-button-prev',
        nextEl: '.gallery__slider .swiper-button-next'
      },
      breakpoints: {
        0: {
          allowTouchMove: true
        },
        1024: {
          allowTouchMove: false
        }
      }
    });
  }

  // gallery buttons
  var gallerySliderHover = document.querySelector('.gallery__slider');
  if (gallerySliderHover) {
    var galleryPrevButton = gallerySliderHover.querySelector('.swiper-button-prev');
    var galleryNextButton = gallerySliderHover.querySelector('.swiper-button-next');
    var galleryCursor = gallerySliderHover.querySelector('.swiper-button-circle--hover');
    if (galleryPrevButton && galleryNextButton && galleryCursor && window.matchMedia('(hover: hover)').matches) {
      var animateCursor = function animateCursor() {
        cursorX += (mouseX - cursorX) * 0.1;
        cursorY += (mouseY - cursorY) * 0.1;
        galleryCursor.style.left = "".concat(cursorX - 50, "px");
        galleryCursor.style.top = "".concat(cursorY - 50, "px");
        requestAnimationFrame(animateCursor);
      };
      var mouseX = 0,
        mouseY = 0;
      var cursorX = 0,
        cursorY = 0;
      gallerySliderHover.addEventListener('mousemove', function (event) {
        var rect = event.currentTarget.getBoundingClientRect();
        mouseX = event.clientX - rect.left;
        mouseY = event.clientY - rect.top;
        galleryCursor.classList.add('is--active');
      });
      gallerySliderHover.addEventListener('mouseleave', function () {
        galleryCursor.classList.remove('is--active');
      });
      galleryPrevButton.addEventListener('mouseenter', function () {
        galleryCursor.textContent = 'Назад';
      });
      galleryNextButton.addEventListener('mouseenter', function () {
        galleryCursor.textContent = 'Далее';
      });
      galleryPrevButton.addEventListener('mouseleave', function () {
        galleryCursor.textContent = '';
      });
      galleryNextButton.addEventListener('mouseleave', function () {
        galleryCursor.textContent = '';
      });
      animateCursor();
    }
  }

  // select case button
  // const selectCaseBg = document.querySelector('.select-case__bg')
  // const selectCaseButtonHover = document.querySelector('.select-case__circle')

  // if (selectCaseButtonHover) {
  //     if (window.matchMedia('(hover: hover)').matches) {
  //         let mouseX = 0, mouseY = 0;
  //         let cursorX = 0, cursorY = 0;

  //         function animateCursor() {
  //             cursorX += (mouseX - cursorX) * 0.1;
  //             cursorY += (mouseY - cursorY) * 0.1;
  //             selectCaseButtonHover.style.left = `${cursorX - 50}px`;
  //             selectCaseButtonHover.style.top = `${cursorY - 50}px`;

  //             requestAnimationFrame(animateCursor);
  //         }

  //         selectCaseBg.addEventListener('mousemove', (event) => {
  //             const rect = event.currentTarget.getBoundingClientRect();
  //             mouseX = event.clientX - rect.left;
  //             mouseY = event.clientY - rect.top;
  //             selectCaseButtonHover.classList.add('is--active')
  //         });

  //         selectCaseBg.addEventListener('mouseleave', () => {
  //             selectCaseButtonHover.classList.remove('is--active')
  //         });

  //         animateCursor();
  //     }
  // }

  // plans
  var plansImg = document.querySelector('.plans__img img');
  var plansSvg = document.querySelector('.plans__svg');
  var plansAreas = document.querySelectorAll('.plans area');
  if (plansImg && plansSvg) {
    plansSvg.setAttribute('viewBox', "0 0 ".concat(plansImg.naturalWidth, " ").concat(plansImg.naturalHeight));
  }
  if (plansAreas) {
    plansAreas.forEach(function (item) {
      item.addEventListener('mouseover', function () {
        document.querySelector('.plans__svg polygon[data-id="' + item.dataset.id + '"]').classList.add('is--hover');
      });
      item.addEventListener('mouseout', function () {
        document.querySelector('.plans__svg polygon[data-id="' + item.dataset.id + '"]').classList.remove('is--hover');
      });
    });
  }

  // navbar scroll
  var lastScrollTop = 0;
  function handleNavbarDisplay() {
    var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    var isMobile = window.innerWidth <= 1023;
    if (isMobile) {
      if (scrollTop > 800) {
        navbar.classList.add('is--active');
      } else {
        navbar.classList.remove('is--active');
      }
    } else {
      if (scrollTop > 600) {
        if (scrollTop < lastScrollTop) {
          navbar.classList.add('is--active');
        } else {
          navbar.classList.remove('is--active');
        }
      } else {
        navbar.classList.remove('is--active');
      }
    }
    lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
  }
  window.addEventListener('scroll', function () {
    if (navbar) {
      handleNavbarDisplay();
    }
  });
});